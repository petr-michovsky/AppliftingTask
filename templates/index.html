<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Basic HTML Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/index.css') }}">

</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>Applifting Python Task API Explorer</h1>
            <a href="/docs">Documentation</a>
        </div>

        <div class="api-explorer-container">
            <div class="url-container">
                <label for="url">API Endpoint:</label>
                <select id="url">
                    <option>/get-products</option>
                    <option>/create-product</option>
                    <option>/delete-product</option>
                    <option>/update-product</option>
                    <option>/get-offers</option>
                </select>
            </div>

            <div class="http-method-container">
                <label for="method">HTTP Method:</label>
                <select id="method">
                    <option>GET</option>
                    <option>POST</option>
                    <option>PUT</option>
                    <option>DELETE</option>
                </select>
            </div>

            <div class="body-container">
                <label for="body">Body (JSON format):</label>
                <textarea id="body" placeholder='{}'></textarea>
            </div>

            <div class="send-request-btn-container">
                <button id="sendRequest">Send Request</button>
            </div>

            <div class="response-container">
                <h2>Response</h2>
                <pre id="response"></pre>
            </div>
        </div>
    </div>
</body>

<script>
    document.getElementById("sendRequest").addEventListener("click", async () => {
        const method = document.getElementById("method").value;
        const url = document.getElementById("url").value;
        const bodyInput = document.getElementById("body").value;

        // Default headers with Content-Type as application/json
        let headers = {
            "Content-Type": "application/json"  // Default for POST, PUT, PATCH
        };

        // Automatically add Authorization header for offers microservice
        if (url.includes("offers")) {
            const accessToken = "your-access-token-here";  // Retrieve this securely in a real application
            headers["Authorization"] = `Bearer ${accessToken}`;
        }

        let body = null;
        if (["POST", "PUT", "PATCH"].includes(method)) {
            try {
                body = bodyInput ? JSON.stringify(JSON.parse(bodyInput)) : "{}";
            } catch (e) {
                document.getElementById("response").textContent = "Invalid body JSON.";
                return;
            }
        }

        if (method === "DELETE") {
            try {
                body = bodyInput ? JSON.stringify(JSON.parse(bodyInput)) : "{}";
            } catch (e) {
                document.getElementById("response").textContent = "Invalid body JSON for DELETE request.";
                return;
            }
        }

        try {
            const response = await fetch(url, {
                method: method,
                headers: headers,
                body: body
            });

            const contentType = response.headers.get("Content-Type");
            const text = await response.text();

            if (contentType && contentType.includes("application/json")) {
                document.getElementById("response").textContent = JSON.stringify(JSON.parse(text), null, 2);
            } else {
                document.getElementById("response").textContent = text;
            }
        } catch (error) {
            document.getElementById("response").textContent = `Request error: ${error.message}`;
        }
    });
</script>


</html>
